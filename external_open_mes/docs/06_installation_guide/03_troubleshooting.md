# トラブルシューティングのヒント

セットアップや運用中によく発生し得る問題と対処法を以下にまとめます。

- **コンテナが起動しない/すぐ停止する**:
  `docker compose ps`で`open_mes`または`postgres`のステータスが`exited`になっている場合、ログを確認します。`docker compose logs open_mes`でアプリケーションコンテナのログを確認し、エラー内容を特定してください。典型的な原因として`.env`の書き漏れ（`SECRET_KEY`未設定、環境変数のタイプミス）や、PostgreSQLへの接続失敗（設定した`DB_USER`/`DB_PASSWORD`が通らない等）が挙げられます。この場合、`.env`を修正後にコンテナを再起動してください（`docker compose up -d --force-recreate`）。

- **マイグレーションエラー**:
  `manage.py migrate` 実行時にエラーが出る場合、既存のマイグレーションファイルの不整合か、データベース接続の問題が考えられます。エラーメッセージ中に`connection refused`等があればDB接続が確立できていません。Dockerが正常に動作しているか、`.env`の`DB_HOST`/`PORT`が正しいか確認しましょう。`relation already exists`のようなエラーは、同じマイグレーションを繰り返し適用しようとした可能性があります。その場合はDjangoのマイグレーション履歴を確認し、必要なら`--fake`オプションを検討してください。

- **管理者でログインできない**:
  `createsuperuser`で設定したパスワードが間違っている可能性があります。もう一度`docker compose exec open_mes python3 manage.py createsuperuser`を実行し、新しい管理者を作成してみてください。既存ユーザーのパスワードリセットには`manage.py changepassword ユーザー名`コマンドも使えます。

- **ページを開いた際にCSRFエラー (Origin checking failed)**:
  これは、アクセス元のURLが信頼できるオリジンとして登録されていない場合に発生します。`.env` ファイルの `CSRF_TRUSTED_ORIGINS` に、ブラウザでアクセスしているURL（スキーマ`http://`または`https://`からポート番号まで全て）を正確に記述してください。
  例えば、`http://example.com:8000` でアクセスしている場合は、`CSRF_TRUSTED_ORIGINS="http://example.com:8000"` のように設定します。複数のオリジンを許可する場合はカンマで区切ります。
  なお、`*`（ワイルドカード）はこの設定では機能しないため、必ず具体的なURLを指定する必要があります。

- **メール送信ができない**:
  パスワードリセット機能等でメールを送ろうとした場合、デフォルトではメールサーバ設定が行われていないため送信に失敗します。本番運用時には`.env`にメールサーバ（SMTP）の設定を追加してください。開発中はDjangoのコンソールメールバックエンドを使うか、`python manage.py sendtestemail`で動作確認できます。

- **パフォーマンスが遅い**:
  開発サーバはシングルスレッドで動作するため、同時アクセスが増えると応答が遅くなります。本番ではGunicorn+Nginxなどの本番構成を検討してください。また、大量のデータ投入時には適切なインデックスが貼られているか確認し、必要に応じてモデルの`Meta`で`index`を追加後にマイグレーションを適用してください。

- **Docker関連の問題**:
  Windows環境でDocker Desktopを使用している場合、WSL2の設定やリソース制限によってコンテナが不安定になることがあります。その際はDocker Desktopの設定でメモリ/CPUの割当を増やす、WSLの更新を行う、あるいはUbuntu上で直接Dockerを動かすなどの対策を試してください。また、Apple M1/M2チップの場合、PostgreSQLイメージがARM対応しているか確認が必要です（基本的には対応済みですが、問題ある場合は`platform: linux/x86_64`指定でIntel版を使う方法もあります）。

以上の点以外にも問題が発生した場合、GitHubリポジトリのIssuesやみはたま株式会社提供のコミュニティ（Discord）で質問することも可能です
(prtimes.jp
prtimes.jp)。オープンソースプロジェクトである強みを活かし、ぜひコミュニティで情報共有しながらトラブルを解決してください。